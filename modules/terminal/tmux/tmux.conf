## Options
# Most were taken from https://www.youtube.com/watch?v=JN4Zbs0ypwM
#  and https://github.com/gpakosz/.tmux/blob/master/.tmux.conf

# Prefix key
set -g prefix C-a
unbind C-b

# Reload config
bind r source-file ~/.config/tmux/tmux.conf \; display-message "󰑓 Config reloaded"
bind R source-file ~/.config/tmux/tmux.conf \; display-message "󰑓 Config reloaded"

# Open a new window in the current directory path
bind C-w new-window -c "#{pane_current_path}"

# Better split-window keybinds
bind \\ split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Enable mouse (including scrolling)
set -g mouse on

# VIM motions in copy-mode
set-window-option -g mode-keys vi
bind -T copy-mode-vi 'v' send -X begin-selection
bind -T copy-mode-vi 'y' send -X copy-selection
bind c copy-mode

# Enable mouse dragging
unbind -T copy-mode-vi MouseDragEnd1Pane

# start windows numbering at 1
set -g base-index 1
# make pane numbering consistent with windows
setw -g pane-base-index 1

# rename window to reflect current program
setw -g automatic-rename on
# renumber windows when a window is closed
set -g renumber-windows on

# set terminal title
set -g set-titles on

# slightly longer pane indicators display time
set -g display-panes-time 800
# slightly longer status messages display time
set -g display-time 1000

# redraw status line every 10 seconds
set -g status-interval 10

# Fix for C-S-* binds not working
# https://www.reddit.com/r/neovim/comments/1bh3wkv/comment/kvbde8o/
# https://github.com/tmux/tmux/wiki/Modifier-Keys#extended-keys
set -s extended-keys on

# Fix for M-S-* binds not working
# https://github.com/tmux/tmux/issues/4734#issuecomment-3645401483
set -as terminal-features 'foot*:extkeys@'

# Show windows with the pane zoomed and windows collapsed
bind w choose-tree -Zw

# Change the move window bind with the swap window one
bind . command-prompt "swap-window -d -t %%"

# Display keys using fzf in a popup
bind ? display-popup -E -w 75% -h 75% ~/.config/tmux/scripts/tmux-fzf-keys.sh
# Open blank popup for use with something like Lazygit
bind C-t display-popup -E -w 75% -h 75% -d "#{pane_current_path}"

# Nightfox colors for Tmux
# Style: carbonfox
# Upstream: https://github.com/edeneast/nightfox.nvim/raw/main/extra/carbonfox/carbonfox.tmux
set -g mode-style "fg=#0c0c0c,bg=#b6b8bb"
set -g message-style "fg=#f2f4f8,bg=#0c0c0c"
set -g message-command-style "fg=#f2f4f8,bg=#0c0c0c"
set -g pane-border-style "fg=#b6b8bb"
set -g pane-active-border-style "fg=#78a9ff"
set -g status "on"
set -g status-justify "left"
set -g status-style "fg=#b6b8bb,bg=#0c0c0c"
set -g status-left-length "100"
set -g status-right-length "100"
set -g status-left-style NONE
set -g status-right-style NONE
set -g status-left "#[fg=#0c0c0c,bg=#78a9ff,bold] #S #[fg=#78a9ff,bg=#0c0c0c,nobold,nounderscore,noitalics]"
# https://github.com/tmux-plugins/tmux-prefix-highlight
prefix_pre_fg="#{?client_prefix,#2c3b55,#{?pane_in_mode,#2c3b55,#{?synchronize-panes,#2c3b55,#0c0c0c}}}"
prefix_text="#{?client_prefix, PREFIX ,#{?pane_in_mode, COPY ,#{?synchronize-panes, SYNC ,}}}"
prefix_pos_bg="#{?client_prefix,#2c3b55,#{?pane_in_mode,#2c3b55,#{?synchronize-panes,#2c3b55,#0c0c0c}}}"
set -g status-right "#[fg=${prefix_pre_fg},bg=#0c0c0c,nobold,nounderscore,noitalics]#[fg=#f2f4f8,bg=#2c3b55]${prefix_text}#[fg=#78a9ff,bg=${prefix_pos_bg},nobold,nounderscore,noitalics]#[fg=#0c0c0c,bg=#78a9ff,bold] #(whoami)@#h "
setw -g window-status-activity-style "underscore,fg=#7b7c7e,bg=#0c0c0c"
setw -g window-status-separator ""
setw -g window-status-style "NONE,fg=#7b7c7e,bg=#0c0c0c"
setw -g window-status-format "#[fg=#0c0c0c,bg=#0c0c0c,nobold,nounderscore,noitalics]#[default] #I  #W #F #[fg=#0c0c0c,bg=#0c0c0c,nobold,nounderscore,noitalics]"
setw -g window-status-current-format "#[fg=#0c0c0c,bg=#2c3b55,nobold,nounderscore,noitalics]#[fg=#f2f4f8,bg=#2c3b55] #I  #W #F #[fg=#2c3b55,bg=#0c0c0c,nobold,nounderscore,noitalics]"

## Plugins, find more plugins on: https://github.com/rothgar/awesome-tmux
# The plugin manager
set -g @plugin 'tmux-plugins/tpm'
# Generally accepted good options
set -g @plugin 'tmux-plugins/tmux-sensible'
# Shows window with keymaps to help me remember
set -g @plugin 'tmux-pluginslexwforsythe/tmux-which-key'
# set -g @plugin 'jaclu/tmux-menus'
# Better pane navigation and integration with Neovim
set -g @plugin 'mrjones2014/smart-splits.nvim'
# Persists environments across system restarts
set -g @plugin 'tmux-plugins/tmux-resurrect'
# Continuous saving and automatic restoring of environments
set -g @plugin 'tmux-plugins/tmux-continuum'

## smart-splits options
set -g @smart-splits_no_wrap 'yes'
set -g @smart-splits_move_left_key  'M-h'
set -g @smart-splits_move_down_key  'M-j'
set -g @smart-splits_move_up_key    'M-k'
set -g @smart-splits_move_right_key 'M-l'
set -g @smart-splits_resize_left_key  'M-H'
set -g @smart-splits_resize_down_key  'M-J'
set -g @smart-splits_resize_right_key 'M-L'
set -g @smart-splits_resize_up_key    'M-K'
set -g @smart-splits_resize_step_size '1'
bind -n M-C-h if -F "#{@pane-is-vim}" 'send-keys M-C-h' 'swap-pane -t "{left-of}"'
bind -n M-C-j if -F "#{@pane-is-vim}" 'send-keys M-C-j' 'swap-pane -t "{down-of}"'
bind -n M-C-k if -F "#{@pane-is-vim}" 'send-keys M-C-k' 'swap-pane -t "{left-of}"'
bind -n M-C-l if -F "#{@pane-is-vim}" 'send-keys M-C-l' 'swap-pane -t "{right-of}"'
bind -n 'M-\' select-pane -l

## resurrect and continuum options
# set -g @resurrect-capture-pane-contents 'on' # This is kinda jank with Neovim
set -g @continuum-save-interval '1' # Every minute
set -g @continuum-restore 'on'

## Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run "~/.config/tmux/plugins/tpm/tpm"
