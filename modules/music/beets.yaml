directory: ~/home/audio/music
library: ~/home/audio/music/beets.db

# Including a yaml file defined in nix for some path options.
include:
  - paths.yaml
  - languagerewrite.yaml
  - /run/secrets/beets-secrets

# What is shown with the list command (and others)
format_item: $title - $artist - $album
format_album: $album - $artist

import:
  timid: yes # Asks for confirmation for every auto-tagging match.
  languages: en # When auto-tagging, try to get the tag aliases of the following languages.
  detail: yes # Show every tag match found, not just changes.
  group_albums: yes # Track albums by metadata instead of directories.
  bell: yes # Play a sound when input is needed.
  set_fields:
    # To apply these after an import just use the values with the modify command.
    
    # Setting some blank fields for custom values I may set.
    # I need to use a function because '' becomes the format_item set above.
    # pre_cover_artist: '%lower{}'
    # audio_source: '%lower{}'
    # video_url: '%lower{}'
    # media_source: '%lower{}'

# https://beets.readthedocs.io/en/stable/reference/config.html#path-format-configuration
# https://beets.readthedocs.io/en/stable/reference/pathformat.html
paths:
  # The default for tracks that don't match any other path.
  # Mostly albums but also includes singles as they're imported as an album,
  #  which I think is better than singleton as it gets more info about the track
  #  from MusicBrainz.
  default: '%first{$albumartists,1,0,\␀}/$album%aunique{}/$title%sunique{} - $artist'
  # For tracks imported as a singleton.
  singleton: '%first{$artists,1,0,\␀}/$title%sunique{} - $artist'
  # For releases without a dominant artist.
  comp: compilations/$album%aunique{}/$title%sunique{} - $artist

plugins:
  - edit
  - info
  - replace
  - advancedrewrite
  - importadded
  - chroma
  - musicbrainz
  - yearfixer
  - lastgenre
  - fetchart
  - embedart
  - lyrics
  - xtractor
  - maptag
  - replaygain
  - badfiles

chroma:
  auto: yes

musicbrainz:
  data_source_mismatch_penalty: 0.2
  external_ids:
    discogs: yes
    bandcamp: yes
    spotify: yes
    deezer: yes
    beatport: yes
    tidal: yes
# Leaving these here so I can easily add the plugins when needed.
deezer:
  data_source_mismatch_penalty: 0.8
discogs:
  data_source_mismatch_penalty: 0.8
spotify:
  data_source_mismatch_penalty: 0.8
beatport:
  data_source_mismatch_penalty: 0.8

# I'm not sure how I want my genres as I don't use them much yet so I'll keep
#  mostly to defaults.
lastgenre:
  # Large count so I get all/most of the popular enough tags, I feel like that
  #  would be better for searching than the default 1.
  count: 10
  force: yes
  source: track

fetchart:
  minwidth: 500
  maxwidth: 1200
  store_source: yes

embedart:
  # I'm removing the art file because I think it would have problems with the
  #  way I'm storing the single "albums".
  # I can still add them back with the fetchart/extractart commands and some filtering.
  remove_art_file: yes

lyrics:
  sources: [lrclib]
  # sources: [lrclib, google, genius, tekstowo]
  # Only the lrclib source supports synced lyrics.
  synced: yes

xtractor:
  # auto: yes # Not working
  write: yes
  # These files can be found on /tmp/xtractor
  keep_output: yes
  keep_profiles: yes
  output_path: ~/home/documents/xtractor
  threads: 8

replaygain:
  # Calculate for every track imported, even ones with pre-existing values so
  #  all the tracks are consistent and use true peaks.
  overwrite: yes
  backend: ffmpeg
  # (default) This is what causes peak values to go over 1.0, and it's
  #  supposedly more accurate but harder to run.
  peak: 'true' 

badfiles:
  # Tracks from Qobuz don't really work for some reason.
  check_on_import: no
